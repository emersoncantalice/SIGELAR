<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	template="/templates/Layout.xhtml">

	<ui:define name="conteudo">
		<p:panel header="FUNCIONÁRIOS">
			<h:form id="formMensagem">
				<p:messages id="mensagem" closable="true" />
			</h:form>
			<h:form id="formListagem">
				<p:dataTable id="tableListagem" paginator="true"
					widgetVar="tableListagem"
					value="#{beanFuncionarioCRUD.funcionarios}" var="funcionario"
					emptyMessage="Nenhum registro encontrado." rows="8">
					<f:facet name="header">
						<h:panelGrid columns="2">
							<p:commandButton value="NOVO"
								actionListener="#{beanFuncionarioCRUD.instanciarNovo()}"
								oncomplete="PF('cadastro').show();" update=":formCadastro">
								<f:actionListener
									type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
							</p:commandButton>
							<p:outputPanel>
								<p:outputLabel for="globalFilter" value="Pesquisar: " />
								<p:inputText id="globalFilter"
									onkeyup="PF('tableListagem').filter()" />
							</p:outputPanel>
						</h:panelGrid>
					</f:facet>

					<p:column headerText="Pessoa" sortBy="#{funcionario.pessoa.nome}">
						<h:outputText value="#{funcionario.pessoa.nome}">
						</h:outputText>
					</p:column>

					<p:column headerText="Data de Admissão"
						sortBy="#{funcionario.pessoa.nome}">
						<h:outputText value="#{funcionario.dataAdmissao}">
							<f:convertDateTime locale="pt_BR" />
						</h:outputText>
					</p:column>

					<p:column headerText="Nº Carteira Trabalho"
						sortBy="#{funcionario.pessoa.nome}">
						<h:outputText value="#{funcionario.carteiraDeTrabalho}" />
					</p:column>

					<p:column headerText="Opções">
						<p:panelGrid columns="4">
							<p:commandLink value="Alterar"
								actionListener="#{beanFuncionarioCRUD.editar}"
								oncomplete="PF('edicao').show();"
								update=":formMensagem:mensagem, :formListagem:tableListagem, :formEdicao">
								<f:actionListener
									type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />

								<f:attribute name="selecionadoCorrente" value="#{funcionario}" />
							</p:commandLink>

							<p:commandLink value="Excluir"
								actionListener="#{beanFuncionarioCRUD.excluir}"
								update=":formMensagem:mensagem, :formListagem:tableListagem">

								<p:confirm header="Confirmação"
									message="Deseja realmente excluir esta pessoa #{pessoa.nome}?"
									icon="ui-icon-alert" />
								<f:attribute name="selecionadoCorrente" value="#{funcionario}" />
							</p:commandLink>

							<p:commandLink value="Visualizar" disabled="true" />

						</p:panelGrid>

					</p:column>
				</p:dataTable>
			</h:form>
		</p:panel>
		<h:form>
			<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
				<p:commandButton value="Sim" type="button"
					styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
				<p:commandButton value="Não" type="button"
					styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</p:confirmDialog>
		</h:form>

		<p:dialog header="Cadastro - Funcionário" widgetVar="cadastro"
			id="cadastroDialog" modal="true" closable="false" hideEffect="fade"
			responsive="true" resizable="false">

			<h:form id="formCadastro">
				<p:messages id="mensagemCadastro" />
				<h:panelGrid columns="2">
					<p:outputLabel for="pessoa" value="Pessoa:" />
					<p:selectOneMenu id="pessoa" maxlength="30" required="true"
						requiredMessage="O campo Pessoa é um campo obrigatório"
						converter="omnifaces.SelectItemsConverter"
						value="#{beanFuncionarioCRUD.funcionario.pessoa}">
						<f:selectItem noSelectionOption="true" itemLabel="SELECIONE" />
						<f:selectItems value="#{beanPessoaCRUD.pessoas}" var="pessoa"
							itemValue="#{pessoa}" itemLabel="#{pessoa.nome}" />
					</p:selectOneMenu>

					<p:outputLabel for="cadastro" value="Admitido em:" />
					<p:calendar maxlength="8" id="cadastro" effect="fade"
						title="SELECIONE"
						value="#{beanFuncionarioCRUD.funcionario.dataAdmissao}"
						required="true"
						requiredMessage="O campo Número é um campo obrigatório"
						locale="pt_BR" />

					<p:outputLabel for="ct" value="Carteira de trabalho" />
					<p:inputText
						value="#{beanFuncionarioCRUD.funcionario.carteiraDeTrabalho}"
						required="true" id="ct"
						requiredMessage="O campo Carteira de trabalho é um campo obrigatório"
						size="30" maxlength="20"></p:inputText>

					<h:panelGrid columns="2">
						<p:commandButton value="Salvar"
							actionListener="#{beanFuncionarioCRUD.salvar()}"
							update=":formCadastro:mensagemCadastro, :formListagem:tableListagem, :formCadastro"
							onsuccess="setTimeout ( '$(\'#formCadastro\\\\:mensagemCadastro\').hide()', 4000);" />
						<p:commandButton value="Cancelar"
							oncomplete="PF('cadastro').hide();" />
					</h:panelGrid>
				</h:panelGrid>
			</h:form>
		</p:dialog>

		<p:dialog header="Editar - Pessoa" widgetVar="edicao"
			id="edicaoDialog" modal="true" closable="false" draggable="false"
			responsive="true" resizable="false">
			<h:form id="formEdicao">
				<p:messages id="mensagemEdicao" />
				<h:panelGrid columns="2">
					<p:outputLabel for="pessoa" value="Pessoa:" />
					<p:selectOneMenu id="pessoa" maxlength="30"
						converter="omnifaces.SelectItemsConverter"
						value="#{beanFuncionarioCRUD.funcionario.pessoa}">
						<f:selectItem noSelectionOption="true" itemLabel="SELECIONE" />
						<f:selectItems value="#{beanPessoaCRUD.pessoas}" var="pessoa"
							itemValue="#{pessoa}" itemLabel="#{pessoa.nome}" />
					</p:selectOneMenu>

					<p:outputLabel for="cadastro" value="Admitido em:" />
					<p:calendar maxlength="8" id="cadastro"
						value="#{beanFuncionarioCRUD.funcionario.dataAdmissao}"
						required="true"
						requiredMessage="O campo Número é um campo obrigatório"
						locale="pt_BR" />

					<p:outputLabel for="ct" value="Carteira de trabalho" />
					<p:inputText
						value="#{beanFuncionarioCRUD.funcionario.carteiraDeTrabalho}"
						required="true" id="ct"
						requiredMessage="O campo Carteira de trabalho é um campo obrigatório"
						size="30" maxlength="20"></p:inputText>

					<h:panelGrid columns="2">
						<p:commandButton value="Salvar"
							actionListener="#{beanFuncionarioCRUD.salvar()}"
							update=":formMensagem:mensagem, :formListagem:tableListagem, :formEdicao"
							onsuccess="setTimeout ( '$(\'#formMensagem\\\\:mensagem\').hide()', 4000);"
							oncomplete="PF('edicao').hide();" />
						<p:commandButton value="Cancelar"
							oncomplete="PF('edicao').hide();" />
					</h:panelGrid>
				</h:panelGrid>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>